# Pet Camera — セットアップ ToDo

実装開始前に **ユーザー自身が手動で行う** アカウント登録・ソフトウェア導入・設定作業の一覧。
コーディング作業は含まない（実装は SPECIFICATION.md の Step 1〜8 を参照）。

---

## 1. アカウント登録

新規にアカウント作成が必要なサービスは **Tailscale の1つだけ**。

### 1-1. Tailscale アカウント作成

- [ ] https://tailscale.com/ にアクセス
- [ ] 「Get Started」をクリック
- [ ] 「Sign up with GitHub」を選択（既存の GitHub アカウントで認証）
- [ ] GitHub の認証画面で「Authorize Tailscale」を許可
- [ ] Tailnet（個人 VPN ネットワーク）が自動作成されることを確認
- [ ] 管理コンソール https://login.tailscale.com/admin にアクセスできることを確認

> 既存アカウント（GitHub / Render / Vercel）の追加登録は不要。

---

## 2. ソフトウェアのインストール

### 2-1. Python（自宅 PC）

- [ ] https://www.python.org/downloads/ から Python 3.10 以上をダウンロード
- [ ] インストーラーを実行し、**「Add Python to PATH」にチェック**を入れてインストール
- [ ] PowerShell で `python --version` を実行し、バージョンを確認

### 2-2. Tailscale クライアント（自宅 PC）

- [ ] https://tailscale.com/download/windows からインストーラーをダウンロード
- [ ] インストーラーを実行
- [ ] タスクトレイの Tailscale アイコンをクリック →「Log in」
- [ ] ブラウザが開くので GitHub で認証
- [ ] タスクトレイアイコンを右クリック →「This machine's IP」で `100.x.x.x` のアドレスをメモ

### 2-3. NSSM（自宅 PC）

- [ ] https://nssm.cc/download から最新版の ZIP をダウンロード
- [ ] ZIP を解凍し、`win64/nssm.exe` を任意の場所に配置（例: `C:\tools\nssm\nssm.exe`）
- [ ] 配置先を PATH に追加、または使用時にフルパスで指定

### 2-4. Tailscale アプリ（自分のスマートフォン）

- [ ] **iPhone**: App Store で「Tailscale」を検索 → インストール
- [ ] **Android**: Google Play で「Tailscale」を検索 → インストール
- [ ] アプリを開く →「Get Started」→ GitHub アカウントで認証
- [ ] Tailnet に参加したことを確認（アプリ上にデバイス一覧が表示される）

### 2-5. Tailscale アプリ（妻のスマートフォン）

以下の **いずれか** を選択:

#### 方法A: 同一 GitHub アカウントでログイン（簡単）

- [ ] 妻のスマホに Tailscale アプリをインストール
- [ ] 自分と **同じ GitHub アカウント** でログイン
- [ ] → 自動的に同じ Tailnet に参加完了

#### 方法B: 別アカウントで招待（GitHub を共有したくない場合）

- [ ] 妻が Tailscale アカウントを新規作成（メールアドレス or 別の認証プロバイダ）
- [ ] 妻のスマホに Tailscale アプリをインストール・ログイン
- [ ] 自分が管理コンソール → 「Users」→「Invite users」→ 妻のメールアドレスを入力して招待
- [ ] 妻が招待を承認 → 同じ Tailnet に参加完了

---

## 3. Tailscale 管理コンソール設定

音声機能（マイク）は HTTPS が必須。Tailscale の証明書機能を有効化する。

### 3-1. MagicDNS 有効化

- [ ] https://login.tailscale.com/admin にアクセス
- [ ] 「DNS」タブを開く
- [ ] 「MagicDNS」のトグルを **ON** にする

### 3-2. HTTPS Certificates 有効化

- [ ] 同じ「DNS」タブ内の「HTTPS Certificates」のトグルを **ON** にする

### 3-3. TLS 証明書の取得

- [ ] PowerShell を **管理者として** 開く
- [ ] 管理コンソールの「Machines」タブで自宅 PC のマシン名と Tailnet 名を確認
  - 例: マシン名 `desktop-abc`、Tailnet 名 `tail12345`
- [ ] 以下のコマンドを実行:
  ```
  tailscale cert desktop-abc.tail12345.ts.net
  ```
- [ ] カレントディレクトリに以下の2ファイルが生成されることを確認:
  - `desktop-abc.tail12345.ts.net.crt`（証明書）
  - `desktop-abc.tail12345.ts.net.key`（秘密鍵）
- [ ] プロジェクトの `certs/` ディレクトリに2ファイルを移動

---

## 4. 自宅 PC の設定

### 4-1. スリープ無効化

外出中に PC がスリープするとカメラが停止するため、無効化が必要。

- [ ] 「設定」→「システム」→「電源とバッテリー」を開く
- [ ] 「画面とスリープ」の「電源接続時にデバイスをスリープ状態にするまでの時間」を **「なし」** に設定

### 4-2. カメラ・マイク・スピーカーの確認

- [ ] 使用するカメラが PC に接続されていることを確認
- [ ] 「設定」→「プライバシーとセキュリティ」→「カメラ」→ アプリのカメラアクセスが許可されていることを確認
- [ ] 「設定」→「プライバシーとセキュリティ」→「マイク」→ アプリのマイクアクセスが許可されていることを確認
- [ ] スピーカーが有効で音声出力先として選択されていることを確認

### 4-3. 環境変数の設定

- [ ] 認証トークンを決める（十分に長いランダム文字列を推奨。例: 20文字以上の英数記号）
- [ ] システム環境変数に以下を設定:

  | 環境変数名 | 値 | 説明 |
  |-----------|-----|------|
  | `PET_CAMERA_TOKEN` | （決めたトークン文字列） | アプリ認証用。ブラウザ初回アクセス時に入力する |
  | `PET_CAMERA_ENV` | `production` | 本番環境モード（HTTPS + WSS を使用） |

  設定方法: 「設定」→「システム」→「バージョン情報」→「システムの詳細設定」→「環境変数」

---

## 5. 証明書の自動更新設定（運用開始後）

Tailscale 証明書は 90日で有効期限切れになるため、月次で自動更新を設定する。

- [ ] `renew-cert.bat` を作成（実装時に自動生成される）
- [ ] 「タスクスケジューラ」を開く
- [ ] 「基本タスクの作成」をクリック
  - 名前: `PetCamera 証明書更新`
  - トリガー: 毎月1日 AM 3:00
  - 操作: `renew-cert.bat` を実行
- [ ] タスクのプロパティで「最上位の特権で実行する」にチェック

---

## 6. 接続テスト（すべてのセットアップ完了後）

- [ ] 自宅 PC で Tailscale が接続中であることを確認
- [ ] スマホで Tailscale アプリが接続中であることを確認
- [ ] スマホのブラウザから `https://<マシン名>.<tailnet名>.ts.net:5555` にアクセス
- [ ] 認証トークンを入力してログインできることを確認
- [ ] ライブ映像が表示されることを確認
- [ ] 音声リスニング（🔊 聞く）で家の音が聞こえることを確認
- [ ] 音声トーク（🎤 話す）で PC のスピーカーから声が出ることを確認
- [ ] 妻のスマホでも同様にアクセス・映像・音声を確認

---

## チェックリスト サマリー

| カテゴリ | 項目数 | 内容 |
|---------|--------|------|
| アカウント登録 | 1 | Tailscale（GitHub 認証で作成） |
| ソフトウェア導入 | 5 | Python, Tailscale(PC), NSSM, Tailscale(自分スマホ), Tailscale(妻スマホ) |
| 管理コンソール設定 | 3 | MagicDNS, HTTPS証明書有効化, TLS証明書取得 |
| PC 設定 | 3 | スリープ無効化, デバイス権限確認, 環境変数設定 |
| 運用設定 | 1 | 証明書自動更新（タスクスケジューラ） |
| 接続テスト | 1 | エンドツーエンド確認 |
